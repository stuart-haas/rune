version: '1.0'
tasks:
  install:
    description: Install nginx with apt
    commands:
      - | 
        sudo apt update \
        && sudo apt install -y nginx \
        && sudo systemctl status nginx --no-pager
    success:
      tasks:
        verify:
          commands:
            - go run . nginx.yml verify
    error:
      tasks:
        uninstall:
          commands:
            - sudo apt remove -y --purge nginx*
            - sudo apt autoremove
  verify:
    description: Ping nginx at localhost
    commands:
      - curl http://localhost
    error:
      tasks:
        install:
          commands:
            - go run . nginx.yml install